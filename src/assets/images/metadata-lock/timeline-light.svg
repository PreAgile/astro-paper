<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 500" style="font-family: 'Segoe UI', system-ui, sans-serif;">
  <defs>
    <marker id="arr-l" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
    <filter id="sh-l" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="1" dy="1" stdDeviation="2" flood-opacity="0.15"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="900" height="500" fill="#ffffff"/>

  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-size="18" font-weight="600" fill="#1e1e1e">장애 발생 Timeline</text>

  <!-- Time axis -->
  <line x1="80" y1="70" x2="850" y2="70" stroke="#374151" stroke-width="2" marker-end="url(#arr-l)"/>
  <text x="870" y="75" font-size="11" fill="#6b7280">시간</text>

  <!-- Time markers -->
  <line x1="120" y1="65" x2="120" y2="75" stroke="#374151" stroke-width="2"/>
  <text x="120" y="58" text-anchor="middle" font-size="10" fill="#6b7280">13:25</text>

  <line x1="320" y1="65" x2="320" y2="75" stroke="#374151" stroke-width="2"/>
  <text x="320" y="58" text-anchor="middle" font-size="10" fill="#6b7280">13:28</text>

  <line x1="520" y1="65" x2="520" y2="75" stroke="#374151" stroke-width="2"/>
  <text x="520" y="58" text-anchor="middle" font-size="10" fill="#6b7280">13:30</text>

  <line x1="750" y1="65" x2="750" y2="75" stroke="#374151" stroke-width="2"/>
  <text x="750" y="58" text-anchor="middle" font-size="10" fill="#6b7280">13:35</text>

  <!-- T1: MQ Worker Transaction -->
  <g filter="url(#sh-l)">
    <rect x="120" y="90" width="630" height="50" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
    <text x="135" y="112" font-size="11" font-weight="600" fill="#1e40af">T1: 메시지 큐 워커</text>
    <text x="135" y="128" font-size="10" fill="#3b82f6">BEGIN; SELECT * FROM reviews ... (MDL_SHARED_WRITE 보유)</text>
    <text x="730" y="120" text-anchor="end" font-size="9" fill="#6b7280">외부 API 호출 + 비즈니스 로직</text>
  </g>

  <!-- T2: ALTER TABLE -->
  <g filter="url(#sh-l)">
    <rect x="320" y="155" width="430" height="50" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <text x="335" y="177" font-size="11" font-weight="600" fill="#92400e">T2: DBA - ALTER TABLE</text>
    <text x="335" y="193" font-size="10" fill="#b45309">MDL_EXCLUSIVE 요청 → 대기 시작 ⏳</text>
  </g>

  <!-- Warning marker -->
  <rect x="310" y="175" width="20" height="20" rx="3" fill="#ef4444"/>
  <text x="320" y="190" text-anchor="middle" font-size="12" fill="#ffffff">!</text>

  <!-- T3: Backend APIs blocked -->
  <g filter="url(#sh-l)">
    <rect x="340" y="220" width="410" height="80" rx="8" fill="#fee2e2" stroke="#ef4444" stroke-width="2"/>
    <text x="355" y="245" font-size="11" font-weight="600" fill="#991b1b">T3~T4: 백엔드 API 요청들</text>
    <text x="355" y="263" font-size="10" fill="#dc2626">SELECT, INSERT, UPDATE → 모두 MDL 대기 상태!</text>
    <text x="355" y="283" font-size="10" fill="#7f1d1d">Convoy Effect 발생 - 수십 개 세션이 큐에 쌓임</text>
  </g>

  <!-- DB Load spike -->
  <g filter="url(#sh-l)">
    <rect x="520" y="315" width="180" height="60" rx="8" fill="#fef2f2" stroke="#fca5a5" stroke-width="2"/>
    <text x="610" y="340" text-anchor="middle" font-size="12" font-weight="700" fill="#dc2626">DB Load 급증!</text>
    <text x="610" y="360" text-anchor="middle" font-size="14" font-weight="600" fill="#991b1b">0.1 → 18.65</text>
  </g>

  <!-- T5: Recovery -->
  <g filter="url(#sh-l)">
    <rect x="750" y="90" width="120" height="210" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
    <text x="810" y="115" text-anchor="middle" font-size="11" font-weight="600" fill="#065f46">T5: 정상화</text>
    <text x="760" y="140" font-size="9" fill="#047857">1. MQ 워커 COMMIT</text>
    <text x="760" y="160" font-size="9" fill="#047857">2. MDL 해제</text>
    <text x="760" y="180" font-size="9" fill="#047857">3. ALTER 실행 (1.2초)</text>
    <text x="760" y="200" font-size="9" fill="#047857">4. 대기 세션 해제</text>
    <text x="810" y="240" text-anchor="middle" font-size="12" font-weight="600" fill="#065f46">DB Load</text>
    <text x="810" y="260" text-anchor="middle" font-size="14" font-weight="700" fill="#10b981">18.65 → 0.21</text>
    <text x="810" y="285" text-anchor="middle" font-size="10" fill="#059669">✓ 정상</text>
  </g>

  <!-- Key insight box -->
  <rect x="80" y="400" width="740" height="85" rx="10" fill="#fffbeb" stroke="#fbbf24" stroke-width="2"/>
  <text x="100" y="425" font-size="13" font-weight="600" fill="#92400e">💡 핵심 포인트</text>
  <text x="100" y="450" font-size="12" fill="#78350f">• ALTER TABLE 자체는 1.2초면 끝나는 작업이었음</text>
  <text x="100" y="470" font-size="12" fill="#78350f">• 문제의 본질: 선행 트랜잭션이 7분간 MDL을 보유하고 있었음</text>
</svg>